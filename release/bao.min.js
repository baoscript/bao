!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("jQuery")):"function"==typeof define&&define.amd?define(["jQuery"],e):"object"==typeof exports?exports.Bao=e(require("jQuery")):t.Bao=e(t.jQuery)}("undefined"!=typeof self?self:this,function(__WEBPACK_EXTERNAL_MODULE_1__){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(module,exports,__webpack_require__){function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){function t(t,e){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){i=!0,a=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),$=__webpack_require__(1),evalWithContext=function(t,e){return new Function("with(this){return "+e+"}").call(t)},Variable=function(){function Variable(t){_classCallCheck(this,Variable),this.name_=t,this.val_=null,this.updateDomElements_()}return _createClass(Variable,[{key:"setVal",value:function(t,e){"object"===(void 0===t?"undefined":_typeof(t))&&t.expr?this.val_=evalWithContext(e.getVarContext(),t.expr):this.val_=t,this.updateDomElements_()}},{key:"getVal",value:function(){return this.val_}},{key:"updateDomElements_",value:function(){$('[data-bao-target="'+this.name_+'"]').val(this.val_)}},{key:"sync",value:function sync(){var el=$('[data-bao-target="'+this.name_+'"]');try{this.val_=eval(el.val())}catch(t){this.val_=el.val()}}}]),Variable}(),Context=function(){function t(){_classCallCheck(this,t),this.vars_=new Map,this.steps_=new Map}return _createClass(t,[{key:"getStep",value:function(t){return this.steps_.has(t)||this.steps_.set(t,new BaoStep(this,t)),this.steps_.get(t)}},{key:"setStep",value:function(t,e){this.getStep(t).parseJsonData(e)}},{key:"maybeDeclareVar",value:function(t){this.hasVar(t)||this.vars_.set(t,new Variable(t))}},{key:"getVar",value:function(t){return this.vars_.get(t)}},{key:"setVar",value:function(t,e){this.maybeDeclareVar(t),this.vars_.get(t).setVal(e,this)}},{key:"hasVar",value:function(t){return this.vars_.has(t)}},{key:"getVarContext",value:function(){var t={},e=!0,n=!1,r=void 0;try{for(var i,a=this.vars_[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=_slicedToArray(i.value,2),s=o[0],l=o[1];t[s]=l.getVal()}}catch(t){n=!0,r=t}finally{try{!e&&a.return&&a.return()}finally{if(n)throw r}}return t}},{key:"sync",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,i=this.vars_[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var a=_slicedToArray(r.value,2);a[0];a[1].sync()}}catch(t){e=!0,n=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw n}}}}]),t}(),BaoStep=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";_classCallCheck(this,t),this.context_=e,this.name_=n,this.print_=void 0,this.init_=null,this.nextSteps_=new Map,this.condition_=null,this.then_=null,this.else_=null,this.goto_=null,this.set_=new Map}return _createClass(t,[{key:"registerButton",value:function(t,e){$('[data-bao-action="'+t+'"]').prop("disabled",!1),$('[data-bao-action="'+t+'"]').click([this.context_,e],function(t){t.data[0].sync(),t.data[1].run()})}},{key:"getName",value:function(){return this.name_}},{key:"parseJsonData",value:function(e){if(e){if(this.name_=e.name,e.init&&(this.init_=new t(this.context_),this.init_.parseJsonData(e.init)),void 0!==e.print&&(this.print_=e.print),e.decl){var n=!0,r=!1,i=void 0;try{for(var a,o=e.decl[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;this.context_.maybeDeclareVar(s)}}catch(t){r=!0,i=t}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}}for(var l in e.set)this.set_.set(l,e.set[l]);if(e.goto&&(this.goto_=this.context_.getStep(e.goto)),e.next)for(var u in e.next){var c=new t(this.context_);c.parseJsonData(e.next[u]),this.nextSteps_.set(u,c)}e.if&&(this.condition_=e.if.condition,this.then_=new t(this.context_),this.then_.parseJsonData(e.if.then),e.if.else&&(this.else_=new t(this.context_),this.else_.parseJsonData(e.if.else)))}}},{key:"setVars_",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,i=this.set_[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var a=_slicedToArray(r.value,2),o=a[0],s=a[1];this.context_.setVar(o,s)}}catch(t){e=!0,n=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw n}}}},{key:"run",value:function(){$("[data-bao-action]").off("click").prop("disabled",!0),this.name_&&console.log("Current step: "+this.name_),this.init_&&this.init_.run(),this.set_&&this.setVars_(),void 0!=this.print_&&console.log(this.print_);var t=!0,e=!1,n=void 0;try{for(var r,i=this.nextSteps_[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var a=_slicedToArray(r.value,2),o=a[0],s=a[1];this.registerButton(o,s)}}catch(t){e=!0,n=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw n}}if(this.condition_){if(evalWithContext(this.context_.getVarContext(),this.condition_))return this.then_.run();if(this.else_)return this.else_.run()}return this.goto_&&this.goto_.run()}}]),t}(),Bao=function(){function t(){_classCallCheck(this,t),this.context_=new Context}return _createClass(t,[{key:"parseString",value:function(t){var e=JSON.parse(t),n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;this.context_.setStep(s.name,s)}}catch(t){r=!0,i=t}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}}},{key:"run",value:function(){this.context_.getStep("#begin").run()}}]),t}();module.exports=Bao},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_1__}])});
//# sourceMappingURL=bao.min.js.map